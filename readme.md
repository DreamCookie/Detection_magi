# Обнаружение и отслеживание объектов в реальном времени с помощью систем машинного зрения

## Рекомендации
Рекомендуется выполнять работу в таких IDE как Visual Studio Code или PyCharm. На Google Colab выполнение может быть затруднено по ряду технических причин.

## Цель работы
- Ознакомиться с технологиями распознавания и отслеживания объектов в реальном времени.
- Применить алгоритмы компьютерного зрения для решения задачи трекинга и классификации движущихся объектов на видео.

## Оборудование и программное обеспечение
1. Веб-камера
2. Python 3.x
3. Библиотеки Python:
   - OpenCV (opencv-python)
   - NumPy
   - TensorFlow / PyTorch (для использования предобученных моделей)
   - opencv-contrib-python (для дополнительных алгоритмов трекинга)

## Библиотеки, фреймворки и требования

### 1. Загрузка предобученной модели YOLOv3

Для загрузки предобученной модели YOLOv3 необходимы следующие файлы:

- [yolov3.weights](https://pjreddie.com/media/files/yolov3.weights)
- [yolov3.cfg](https://raw.githubusercontent.com/pjreddie/darknet/master/cfg/yolov3.cfg)
- [coco.names](https://raw.githubusercontent.com/pjreddie/darknet/master/data/coco.names)

Можно найти их на GitHub или на [данном сайте](https://www.webosose.org/samples/2022/02/18/object-detection-using-yolov3/).

#### Команды для загрузки файлов через терминал:
```bash
wget https://pjreddie.com/media/files/yolov3.weights
wget https://raw.githubusercontent.com/pjreddie/darknet/master/cfg/yolov3.cfg
wget https://raw.githubusercontent.com/pjreddie/darknet/master/data/coco.names
```

### Для PowerShell:
```bash
Invoke-WebRequest -Uri https://raw.githubusercontent.com/pjreddie/darknet/master/data/coco.names -OutFile coco.names
Invoke-WebRequest -Uri https://raw.githubusercontent.com/pjreddie/darknet/master/cfg/yolov3.cfg -OutFile yolov3.cfg
Invoke-WebRequest -Uri https://pjreddie.com/media/files/yolov3.weights -OutFile yolov3.weights
```

### 2. Установка библиотек
```bash
pip install opencv-python opencv-contrib-python numpy
```
### 3. Условия

- Необходимо находить человека в видеопотоке и отслеживать его.
- Использование GPU не предусмотрено, дообучение моделей не выполняется. Обнаружение объектов выполняется один раз за цикл, затем включается трекинг для снижения вычислительных мощностей.

## Алгоритм работы системы

### Инициализация:

1. Импорт библиотек (`numpy`, `cv2`, и др.).
2. Загрузка классов объектов из файла `coco.names`. Класс "person" находится под индексом 0 (индекс может варьироваться в зависимости от файла).
3. Загрузка предобученной модели YOLOv3 с помощью `cv2.dnn.readNet`.
4. Настройка видеопотока с использованием `cv2.VideoCapture`.
5. Создание объекта `cv2.MultiTracker_create()` для отслеживания нескольких объектов.
6. Определение зоны интереса (ROI) — установка координат зоны на кадре.

### Основной цикл обработки кадров:

1. Считывание кадров из видеопотока.
2. Обнаружение людей и инициализация трекеров для последующего отслеживания.
3. Преобразование кадров в формат `blob` для модели YOLOv3.
4. Применение Non-Maximum Suppression (NMS) для удаления пересекающихся прямоугольников.
5. Отслеживание объектов на последующих кадрах с обновлением позиций трекеров.
6. Визуализация: рисование прямоугольников вокруг объектов, проверка нахождения объектов в зоне интереса, вывод предупреждений.

### Обработка ввода с клавиатуры:

- Нажатие клавиши `q` завершает программу.
- Нажатие клавиши `r` сбрасывает трекеры для повторного обнаружения объектов.

### Завершение работы:

- Остановка видеопотока и закрытие всех окон с помощью `cap.release()` и `cv2.destroyAllWindows()`.

## Часто задаваемые вопросы

- **В: Что есть обнаружение и что есть отслеживание?**
  - Обнаружение выполняется с использованием модели YOLOv3, требует больших вычислительных ресурсов. Отслеживание работает быстрее и позволяет обрабатывать кадры в реальном времени.

- **В: Почему обнаружение выполняется один раз?**
  - Чтобы снизить нагрузку на систему и ускорить обработку кадров.

- **В: Зачем нужна зона интереса (ROI)?**
  - Она позволяет сосредоточиться на важных областях кадра, например, на опасных зонах на производстве.

- **В: Что если трекер потеряет объект?**
  - В случае потери объекта можно сбросить трекеры и выполнить повторное обнаружение.

- **В: Какие параметры можно настроить?**
  - Порог доверия (`confidence > 0.5`), параметры Non-Maximum Suppression, координаты зоны интереса (`roi_start` и `roi_end`).

- **В: Где это может пригодиться?**
  - Для мониторинга опасных зон, контроля периметра, анализа поведения людей и предотвращения столкновений.

- **В: Что может пойти не так?**
  - Всё! Зависит от мощности компьютера и условий выполнения задания. Если в коде будут обнаружены ошибки — сообщите о них, я буду рад исправлениям!

